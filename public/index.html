<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GET and POST API JSON Display</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 150px; margin-top: 10px; }
    a { margin-right: 20px; cursor: pointer; color: blue; text-decoration: underline; display: inline-block; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>Demo the Bff https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps#name-backend-for-frontend-bff</h2>

  <!-- Links -->
  <a id="checkSession">Check Session</a>
  <a id="postApiCall">User Info Call</a>
  <a id="logoutCall">Logout</a>

  <!-- GET API Response -->
  <h3>Check Response data:</h3>
  <textarea id="getResponseBox" readonly></textarea>

  <!-- POST API Response -->
  <h3>UserInfo Response data:</h3>
  <textarea id="postResponseBox" readonly></textarea>

  <!-- Script -->
  <script>
    // GET API call
    document.getElementById('checkSession').addEventListener('click', function(event) {
      event.preventDefault();

    fetch('https://api.test.com/session', {
      method: 'GET',
      credentials: 'include'
    })
    .then(res => res.json())
    .then(data => {
      if (data.authenticated) {
        document.getElementById('getResponseBox').innerText = 'âœ… Session valid. You are authenticated.';
      } else if (data.auth_url) {
        document.getElementById('getResponseBox').innerText = 'ðŸ” Redirecting to login...';
        window.location.href = data.auth_url;
      } else {
        document.getElementById('getResponseBox').innerText = 'âš ï¸ Unknown session state.';
      }
    })
    .catch(err => {
      console.error('Session check error:', err);
      document.getElementById('message').innerText = 'âŒ Failed to check session.';
    });
 
    });

    // POST API call
    document.getElementById('postApiCall').addEventListener('click', function(event) {
      event.preventDefault();

      const postApiUrl = 'https://api.test.com/resource/oidc/userinfo';
 

      fetch(postApiUrl, {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('POST API error');
        }
        return response.json();
      })
      .then(data => {
        document.getElementById('postResponseBox').value = JSON.stringify(data, null, 2);
      })
      .catch(error => {
        document.getElementById('postResponseBox').value = 'Error: ' + error.message;
      });
    });

    // Logout API call
    document.getElementById('logoutCall').addEventListener('click', function(event) {
      event.preventDefault();

      fetch('https://api.test.com/logout', {
        method: 'POST',
        credentials: 'include'
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('getResponseBox').innerText = 'ðŸ”“ ' + JSON.stringify(data, null, 2);
        document.getElementById('postResponseBox').value = ''; // Clear any user info
      })
      .catch(error => {
        document.getElementById('getResponseBox').innerText = 'Logout error: ' + error.message;
      });
    });
  </script>

</body>
</html>
